window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();var tweenEmptyFunc=function(){},TweenObject=Base.extend({object:null,property:"",initial:0,destination:0,time:0,easing:"easeLinearIn",callback:tweenEmptyFunc,currentTime:0,constructor:function(a,b,c,d,e,f){this.object=a,this.initial=this.object[b],this.property=b,this.destination=c,this.time=d,"undefined"!=typeof e&&null!==e&&(this.easing=e),"undefined"!=typeof f&&null!==f&&(this.callback=f)}}),UtilsDef=Base.extend({_tweenFuncs:null,_tweens:null,E_LINEAR_IN:"easeLinearIn",E_LINEAR_OUT:"easeLinearOut",E_LINEAR_INOUT:"easeLinearInOut",E_SINE_IN:"easeSineIn",E_SINE_OUT:"easeSineOut",E_SINE_INOUT:"easeSineInOut",E_QUAD_IN:"easeQuadIn",E_QUAD_OUT:"easeQuadOut",E_QUAD_INOUT:"easeQuadInOut",E_EXPO_IN:"easeExpoIn",E_EXPO_OUT:"easeExpoOut",E_EXPO_INOUT:"easeExpoInOut",E_ELASTIC_IN:"easeElasticIn",E_ELASTIC_OUT:"easeElasticOut",E_ELASTIC_INOUT:"easeElasticInOut",E_CUBIC_IN:"easeCubicIn",E_CUBIC_OUT:"easeCubicOut",E_CUBIC_INOUT:"easeCubicInOut",E_CIRCULAR_IN:"easeCircularIn",E_CIRCULAR_OUT:"easeCircularOut",E_CIRCULAR_INOUT:"easeCircularInOut",E_BOUNCE_IN:"easeBounceIn",E_BOUNCE_OUT:"easeBounceOut",E_BOUNCE_INOUT:"easeBounceInOut",E_BACK_IN:"easeBackIn",E_BACK_OUT:"easeBackOut",E_BACK_INOUT:"easeBackInOut",constructor:function(){this._tweenFuncs={},this._tweenFuncs[this.E_LINEAR_IN]=this.easeLinear.bind(this),this._tweenFuncs[this.E_LINEAR_OUT]=this.easeLinear.bind(this),this._tweenFuncs[this.E_LINEAR_INOUT]=this.easeLinear.bind(this),this._tweenFuncs[this.E_SINE_IN]=this.easeSineIn.bind(this),this._tweenFuncs[this.E_SINE_OUT]=this.easeSineOut.bind(this),this._tweenFuncs[this.E_SINE_INOUT]=this.easeSineInOut.bind(this),this._tweenFuncs[this.E_QUAD_IN]=this.easeQuadIn.bind(this),this._tweenFuncs[this.E_QUAD_OUT]=this.easeQuadOut.bind(this),this._tweenFuncs[this.E_QUAD_INOUT]=this.easeQuadInOut.bind(this),this._tweenFuncs[this.E_EXPO_IN]=this.easeExpoIn.bind(this),this._tweenFuncs[this.E_EXPO_OUT]=this.easeExpoOut.bind(this),this._tweenFuncs[this.E_EXPO_INOUT]=this.easeExpoInOut.bind(this),this._tweenFuncs[this.E_ELASTIC_IN]=this.easeElasticIn.bind(this),this._tweenFuncs[this.E_ELASTIC_OUT]=this.easeElasticOut.bind(this),this._tweenFuncs[this.E_ELASTIC_INOUT]=this.easeElasticInOut.bind(this),this._tweenFuncs[this.E_CUBIC_IN]=this.easeCubicIn.bind(this),this._tweenFuncs[this.E_CUBIC_OUT]=this.easeCubicOut.bind(this),this._tweenFuncs[this.E_CUBIC_INOUT]=this.easeCubicInOut.bind(this),this._tweenFuncs[this.E_CIRCULAR_IN]=this.easeCircularIn.bind(this),this._tweenFuncs[this.E_CIRCULAR_OUT]=this.easeCircularOut.bind(this),this._tweenFuncs[this.E_CIRCULAR_INOUT]=this.easeCircularInOut.bind(this),this._tweenFuncs[this.E_BOUNCE_IN]=this.easeBounceIn.bind(this),this._tweenFuncs[this.E_BOUNCE_OUT]=this.easeBounceOut.bind(this),this._tweenFuncs[this.E_BOUNCE_INOUT]=this.easeBounceInOut.bind(this),this._tweenFuncs[this.E_BACK_IN]=this.easeBackIn.bind(this),this._tweenFuncs[this.E_BACK_OUT]=this.easeBackOut.bind(this),this._tweenFuncs[this.E_BACK_INOUT]=this.easeBackInOut.bind(this),this._tweens=[]},update:function(a){for(var b,c=0;c<this._tweens.length;c++){var d=0;(this.isEmpty(this._tweens[c].object)||this.isEmpty(this._tweens[c].object[this._tweens[c].property]))&&(this._tweens.indexOf(this._tweens[c]),this._tweens.splice(d,1)),this._tweens[c].currentTime+=a,b=this._execTween(this._tweens[c].currentTime,this._tweens[c].initial,this._tweens[c].destination-this._tweens[c].initial,this._tweens[c].time,this._tweens[c].easing),this._tweens[c].object[this._tweens[c].property]=b,this._tweens[c].currentTime>=this._tweens[c].time&&(this._tweens[c].object[this._tweens[c].property]=this._tweens[c].destination,this._tweens[c].callback(),this._tweens.indexOf(this._tweens[c]),this._tweens.splice(d,1))}},reset:function(){for(var a=0;a<this._tweens.length;a++)this._tweens[a].object[this._tweens[a].property]=this._tweens[a].destination,this._tweens[a].callback();this._tweens=[]},emptyFunc:function(){},isEmpty:function(a){return"undefined"==typeof a||null===a},copyAttributes:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},checkExtension:function(a,b){return this.isEmpty(a)?!1:-1!==a.indexOf(b)},indexToDecimal:function(a){return Math.floor(Math.min(255*a,255))},rgbaToString:function(a,b,c,d){var e="rgba("+this.indexToDecimal(a)+","+this.indexToDecimal(b)+","+this.indexToDecimal(c)+","+this.clamp(0,d,1)+")";return e},invoke:function(a,b){setTimeout(a,1e3*b)},invokeRepeating:function(a,b){setInterval(a,1e3*b)},distance:function(a,b,c,d){return Math.sqrt((a-=c)*a+(b-=d)*b)},angle:function(a,b,c,d){return Math.atan2(c-a,d-b)},randRange:function(a,b){return Math.random()*b+a},intRandRange:function(a,b){return Math.floor(this.randRange(a,b))},randSpread:function(a){return this.randRange(0,a)*(.5-Math.random())},randSign:function(){return Math.random()<.5?-1:1},randFlipCoin:function(){return Math.random()<.5?!1:!0},clamp:function(a,b,c){return Math.min(Math.max(b,a),c)},lerp:function(a,b,c){return a+(b-a)*c},perp:function(a,b,c){return a+c*c*(b-a)},berp:function(a,b,c){return a+c/2*(b-a)},smoothStep:function(a){return a*a*(3-2*a)*2},easeLinear:function(a,b,c,d){return c*a/d+b},easeSineIn:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeSineOut:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeSineInOut:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},easeQuadIn:function(a,b,c,d){return c*(a/=d)*a+b},easeQuadOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeQuadInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*((a-2)*--a-1)+b},easeExpoIn:function(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b},easeExpoOut:function(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeExpoInOut:function(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},easeElasticIn:function(a,b,c,d){if(0===a)return b;if(1===(a/=d))return b+c;var e=.3*d,f=c,g=e/4,h=f*Math.pow(2,10*(a-=1));return-(h*Math.sin(2*(a*d-g)*Math.PI/e))+b},easeElasticOut:function(a,b,c,d){if(0===a)return b;if(1===(a/=d))return b+c;var e=.3*d,f=c,g=e/4;return f*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/e)+c+b},easeElasticInOut:function(a,b,c,d){if(0===a)return b;if(2===(a/=d/2))return b+c;var e,f=.45*d,g=c,h=f/4;return 1>a?(e=g*Math.pow(2,10*(a-=1)),-.5*e*Math.sin(2*(a*d-h)*Math.PI/f)+b):(e=g*Math.pow(2,-10*(a-=1)),e*Math.sin(2*(a*d-h)*Math.PI/f)*.5+c+b)},easeCubicIn:function(a,b,c,d){return c*(a/=d)*a*a+b},easeCubicOut:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},easeCubicInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b},easeCircularIn:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},easeCircularOut:function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},easeCircularInOut:function(a,b,c,d){return(a/=d/2)<1?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-a*(a-=2))+1)+b},easeBounceOut:function(a,b,c,d){var e;return(a/=d)<.3636?7.5625*c*a*a+b:.7272>a?(e=a-=.5454,c*(7.5625*e*a+.75)+b):.909>a?(e=a-=.8181,c*(7.5625*e*a+.9375)+b):(e=a-=.9545,c*(7.5625*e*a+.984375)+b)},easeBounceIn:function(a,b,c,d){return c-UtilsDef.prototype.bounceOut(d-a,0,c,d)+b},easeBounceInOut:function(a,b,c,d){return d/2>a?.5*UtilsDef.prototype.bounceIn(2*a,0,c,d)+b:.5*UtilsDef.prototype.bounceOut(2*a-d,0,c,d)+.5*c+b},easeBackIn:function(a,b,c,d){var e=1.70158,f=a/=d;return c*f*a*((e+1)*a-e)+b},easeBackOut:function(a,b,c,d){var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeBackInOut:function(a,b,c,d){var e=1.70158;if((a/=d/2)<1)return c/2*a*a*(((e*=1.525)+1)*a-e)+b;var f=a-=2;return c/2*(f*a*(((e*=1.525)+1)*a+e)+2)+b},_execTween:function(a,b,c,d,e){var f=this._tweenFuncs[e](a,b,c,d);return f},tween:function(a,b,c,d,e,f){this._tweens.push(new TweenObject(a,b,c,d,e,f))}}),Utils=new UtilsDef,Entity=Base.extend({name:"",entities:null,inUse:!0,constructor:function(a){this.name=a,this.entities=[]},spawn:function(){this.inUse=!0},add:function(a){this.entities.push(a)},remove:function(a){var b=this.entities.indexOf(a);b>-1&&this.entities.splice(b,1)},removeAll:function(){this.entities=[]},clone:function(){var a=new Entity;return a=Utils.copyAttributes(a,this)},update:function(a){for(var b=0;b<this.entities.length;b++)this.entities[b].update(a)},draw:function(){for(var a=0;a<this.entities.length;a++)this.entities[a].draw()},destroy:function(){for(var a=0;a<this.entities.length;a++)this.entities[a].destroy();delete this.entities}}),Pool=Entity.extend({lastSpawned:0,constructor:function(){this.callParent("Pool")},addToPool:function(a,b){if(!(a instanceof Entity))return void console.log("[Core::Pool] Unable to add object "+a+". You must extend from Entity");a.inUse=!1;for(var c=0;b>c;c++){var d=a.clone();this.entities.push(d)}},spawn:function(a){for(var b=[],c=this.lastSpawned;c<this.entities.length&&(this.entities[c].inUse||(this.entities[c].spawn(),this.lastSpawned++),a--,b.push(this.entities[c]),!(0>=a));c++);return this.lastSpawned=this.lastSpawned%this.entities.length,b},update:function(a){var b,c;for(b=this.entities.length-1;b>=0;b--)c=this.entities[b],c.inUse&&c.update(a)},draw:function(){for(var a=0;a<this.entities.length;a++)this.entities[a].inUse&&this.entities[a].draw()}}),State=Entity.extend({constructor:function(a){this.callParent(a)},init:function(){},onPause:function(a){}});Core=Base.extend({currentState:null,width:0,height:0,isStorageAvailable:!1,fps:0,fpsCounter:0,elapsed:0,totalTime:0,delta:.016,timeScale:1,date:null,dateNow:null,dateThen:null,assets:null,assetsMap:null,assetsLoaded:0,isPaused:!1,constructor:function(){},init:function(a,b){this.width=a,this.height=b,window.addEventListener("resize",this._calculateResize.bind(this)),window.addEventListener("blur",this._onBlur.bind(this)),Graphics.init(this.width,this.height),this._calculateResize(),this.delta=0,this.date=new Date,this.dateThen=Date.now(),this.dateNow=Date.now(),this.isStorageAvailable=this.hasStorageSupport(),this.assets=[],this.assetsMap={}},_calculateResize:function(){var a=this.width,b=this.height,c=window.innerWidth,d=window.innerHeight,e=Math.min(c/a,d/b),f=Math.floor(a*e),g=Math.floor(b*e),h=(c-f)/2,i=(d-g)/2;Graphics.rescale(f,g),Graphics.reposition(h,i)},_onBlur:function(){this.isPaused=!0,Input.resetAll(),null!==this.currentState&&this.currentState.onPause(!0)},pause:function(a){a?this._onBlur():(this.isPaused=!1,null!==this.currentState&&this.currentState.onPause(!1))},update:function(a){this.elapsed+=a,this.fpsCounter++,this.elapsed>=1&&(this.elapsed=0,this.fps=this.fpsCounter,this.fpsCounter=0),this.isPaused?Input.isMousePressed()&&this.pause(!1):(this.totalTime+=a,null!==this.currentState&&this.currentState.update(a*this.timeScale),Utils.update(a*this.timeScale),Graphics.update(a*this.timeScale))},draw:function(){null!==this.currentState&&(Graphics.preDraw(),this.currentState.draw(),Graphics.postDraw()),this.isPaused&&(Graphics.drawRect(0,0,Graphics.width,Graphics.height,0,0,0,.72),Graphics.enableBlur(5,1,1,1,1),Graphics.drawRegularPolygon(Graphics.width/2,Graphics.height/2,3,Utils.scalePercentWidth(25),1,1,1,1,"fill"),Graphics.disableBlur())},run:function(a){this.dateNow=this.date.getTime(),this.delta=this.dateNow-this.dateThen,this.delta=this.delta||.016,this.dateThen=this.dateNow,this.update(this.delta),this.draw(),window.requestAnimFrame(this.run.bind(this))},setState:function(a){null!==this.currentState&&this.currentState.destroy(),this.currentState=null,this.currentState=a,this._calculateResize()},getFPS:function(){return this.fps},addAsset:function(a){if(a instanceof Array)for(var b=0;b<a.length;b+=2)this.assetsMap[a[b]]=a[b+1],this.assets.push(a[b+1]);else"string"==typeof a?(this.assets.push(a),this.assetsMap[""]=a):console.log("[Core::addAsset] You should not try to add ",a," as an asset. Try using a string or an array instead.")},loadAndRun:function(){var a,b=!0;for(var c in this.assetsMap)a=this.assetsMap[c],this.assetsMap.hasOwnProperty(c)&&(Utils.checkExtension(a,".jpg")||Utils.checkExtension(a,".png")||Utils.checkExtension(a,".svg"))&&(b=!1,Graphics.loadImage(c,a));b&&this.onImageLoaded()},hasStorageSupport:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},saveToStorage:function(a,b){this.isStorageAvailable&&(localStorage[a]=b)},readFromStorage:function(a){return this.isStorageAvailable?localStorage[a]:null},onImageLoaded:function(){this.assetsLoaded++,this.assetsLoaded>=this.assets.length?null!==this.currentState&&(this.currentState.init(),this.run()):(Graphics.drawFullScreenRect(0,0,0,1),Graphics.enableBlur(25,1,1,1,1),Graphics.drawRegularPolygon(Graphics.width/2,Graphics.height/2,Math.round(this.assetsLoaded/this.assets.length*10)+3,Utils.scalePercentWidth(15),1,1,1,1,"fill"),Graphics.disableBlur(),console.log("[Core::onImageLoaded] Loaded: "+this.assetsLoaded+" / "+(this.assets.length-1)))}});var Core=new Core;Utils.scalePercentWidth=function(a){return Math.round(Core.width*a/100)},Utils.scalePercentHeight=function(a){return Math.round(Core.height*a/100)},Input=Base.extend({keysDown:{},isClick:!1,clickPosition:{x:0,y:0},mousePosition:{x:0,y:0},inputObjectsRegistered:[],supportsMultitouch:!1,scale:{x:1,y:1},offset:{x:0,y:0},KEY_BACK:8,KEY_TAB:9,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CLOCK:20,KEY_ESC:27,KEY_SPACE:32,KEY_PGUP:33,KEY_PGDOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_INSERT:45,KEY_DEL:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,KEY_NUM0:96,KEY_NUM1:97,KEY_NUM2:98,KEY_NUM3:99,KEY_NUM4:100,KEY_NUM5:101,KEY_NUM6:102,KEY_NUM7:103,KEY_NUM8:104,KEY_NUM9:105,KEY_MUL:106,KEY_ADD:107,KEY_SUB:109,KEY_POINT:110,KEY_DIV:111,constructor:function(){this.inputObjectsRegistered=[],this.supportsMultitouch=this.checkMulitouchSupport(),this.supportsMultitouch?(addEventListener("touchstart",function(a){var b=a.changedTouches,c=b[0];Input.generateClick(c.clientX,c.clientY)},!0),addEventListener("touchend",function(a){Input.releaseClick()},!0)):(addEventListener("mousedown",function(a){Input.generateClick(a.clientX,a.clientY)},!0),addEventListener("mouseup",function(a){Input.releaseClick()},!0),addEventListener("mousemove",function(a){Input.mouseMoved(a.clientX,a.clientY)},!0))},resetAll:function(){this.keysDown={},this.isClick=!1,this.clickPosition={x:0,y:0},this.mousePosition={x:0,y:0}},checkMulitouchSupport:function(){return"ontouchstart"in document.documentElement},addInputReceiver:function(a){this.inputObjectsRegistered.push(a)},isKeyPressed:function(a){return a in this.keysDown},isMousePressed:function(){return this.isClick===!0},isMouseReleased:function(){return this.isClick===!1},generateClick:function(a,b){this.isClick=!0,this.clickPosition.x=this.mousePosition.x=a/this.scale.x-this.offset.x/this.scale.x,this.clickPosition.y=this.mousePosition.y=b/this.scale.y-this.offset.y/this.scale.y;for(var c=0;c<this.inputObjectsRegistered.length;c++)this.inputObjectsRegistered[c].onClickInput(this.clickPosition.x,this.clickPosition.y)},releaseClick:function(){this.isClick=!1,this.clickPosition.x=-1,this.clickPosition.y=-1},mouseMoved:function(a,b){this.mousePosition.x=a/this.scale.x-this.offset.x/this.scale.x,this.mousePosition.y=b/this.scale.y-this.offset.y/this.scale.y},getMousePosition:function(){return this.mousePosition},getMousePositionInWorld:function(){var a={x:this.mousePosition.x+Camera.x,y:this.mousePosition.y+Camera.y};return a}});var Input=new Input;addEventListener("keydown",function(a){Input.keysDown[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete Input.keysDown[a.keyCode]},!1),Camera2d=Entity.extend({x:0,y:0,shaking:!1,shakeStrength:1,shakeTime:0,shakeOffset:null,onShakeEndCallback:Utils.emptyFunc,fading:!1,overlayColor:null,drawOverlay:!1,onFadeEndCallback:Utils.emptyFunc,constructor:function(){this.callParent("Camera"),this.overlayColor={r:0,g:0,b:0,a:0},this.shakeOffset={x:0,y:0}},shake:function(a,b,c){this.shaking=!0,this.shakeTime=a,this.shakeStrength=b,this.onShakeEndCallback=Utils.isEmpty(c)?Utils.emptyFunc:c},stopShake:function(){this.shaking=!1,this.shakeTime=0,this.shakeStrentgh=0,this.shakeOffset.x=0,this.shakeOffset.y=0},fade:function(a,b,c,d,e){this.fading=!0,this.onFadeEndCallback=Utils.isEmpty(e)?Utils.emptyFunc:e,this.overlayColor.r=a.r,this.overlayColor.g=a.g,this.overlayColor.b=a.b,this.overlayColor.a=a.a,Utils.tween(this.overlayColor,"r",b.r,c,d,e),Utils.tween(this.overlayColor,"g",b.g,c,d),Utils.tween(this.overlayColor,"b",b.b,c,d),Utils.tween(this.overlayColor,"a",b.a,c,d)},update:function(a){this.callParent(a),this.shaking===!0&&(this.shakeTime-=a,this.shakeOffset.x=Utils.randRange(-1*this.shakeStrength,this.shakeStrength),this.shakeOffset.y=Utils.randRange(-1*this.shakeStrength,this.shakeStrength),this.shakeTime<=0&&(this.shaking=!1,this.shakeStartTime=0,this.shakeTime=0,this.onShakeEndCallback(),this.shakeOffset.x=0,this.shakeOffset.y=0))},draw:function(){this.callParent()},getX:function(){return Math.round(this.x+this.shakeOffset.x)},getY:function(){return Math.round(this.y+this.shakeOffset.y)},setOverlayColor:function(a,b,c,d){this.overlayColor.r=a,this.overlayColor.g=b,this.overlayColor.b=c,this.overlayColor.a=d,this.drawOverlay=!0},clearOverlayColor:function(){this.overlayColor.r=0,this.overlayColor.g=0,this.overlayColor.b=0,this.overlayColor.a=0,this.drawOverlay=!1,this.fading=!1}});var Camera=new Camera2d;Graphics=Base.extend({canvas:null,context:null,images:null,imagesMap:null,scale:{x:1,y:1},screenRect:null,autoClearScreen:!0,constructor:function(){this.images=[],this.imagesMap={}},init:function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b,this.canvas.style.position="absolute",document.body.appendChild(this.canvas),this.screenRect=this.canvas.getBoundingClientRect()},rescale:function(a,b){this.scale.x=a/this.width,this.scale.y=b/this.height,this.canvas.style.width=a+"px",this.canvas.style.height=b+"px",this.screenRect=this.canvas.getBoundingClientRect(),Input.scale.x=this.scale.x,Input.scale.y=this.scale.y,Input.offset.x=this.screenRect.left,Input.offset.y=this.screenRect.top},reposition:function(a,b){this.canvas.style.left=a+"px",this.canvas.style.top=b+"px"},pixelify:function(a){this.context.imageSmoothingEnabled=!a},getCanvasOffset:function(){return this.screenRect},getWidth:function(){return this.canvas.width},getHeight:function(){return this.canvas.height},onImageLoaded:function(){Core.onImageLoaded()},loadImage:function(a,b){Utils.isEmpty(this.images[b])?(this.images[b]=new Image,this.images[b].src=b,this.images[b].addEventListener("load",this.onImageLoaded.bind(this)),this.imagesMap[a]=b):this.onImageLoaded()},getImage:function(a){return Utils.isEmpty(this.images[a])?Utils.isEmpty(this.imagesMap[a])?(console.log("[Graphics] The image "+a+" is not loaded. Check if it was added on the asset list (addAsset)."),null):this.images[this.imagesMap[a]]:this.images[a]},update:function(a){Camera.update(a)},preDraw:function(){this.autoClearScreen&&this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.context.save(),this.context.translate(-Camera.getX(),-Camera.getY()),this.context.scale(this.scaleRatio,this.scaleRatio)},postDraw:function(){this.context.restore(),Camera.draw(),(Camera.fading||Camera.drawOverlay)&&this.drawRect(Camera.x,Camera.y,8*this.width,8*this.height,Camera.overlayColor.r,Camera.overlayColor.g,Camera.overlayColor.b,Camera.overlayColor.a)},_startDraw:function(a,b,c,d,e){"fill"===a?this.context.fillStyle=Utils.rgbaToString(b,c,d,e):"stroke"===a&&(this.context.strokeStyle=Utils.rgbaToString(b,c,d,e))},_endDraw:function(a){"fill"===a?this.context.fill():"stroke"===a&&this.context.stroke()},enableBlur:function(a,b,c,d,e){Graphics.context.shadowBlur=a,Graphics.context.shadowColor=Utils.rgbaToString(b,c,d,e)},disableBlur:function(){Graphics.context.shadowBlur=0,Graphics.context.shadowColor=Utils.rgbaToString(0,0,0,0)},drawText:function(a,b,c,d,e,f,g,h,i){this._startDraw("fill",d,e,f,g),this.context.font=h+"px "+i,this.context.textAlign="left",this.context.textBaseline="top",this.context.fillText(a,b,c)},drawRect:function(a,b,c,d,e,f,g,h,i){Utils.isEmpty(i)&&(i="fill"),this._startDraw(i,e,f,g,h),"fill"===i?this.context.fillRect(a,b,c,d):"stroke"===i&&this.context.strokeRect(a,b,c,d)},drawFullScreenRect:function(a,b,c,d){this.drawRect(Camera.getX(),Camera.getY(),this.width,this.height,a,b,c,d)},drawLine:function(a,b,c,d,e,f,g,h,i,j){this.context.beginPath(),this.context.moveTo(a,b),this.context.lineTo(c,d),Utils.isEmpty(i)||(this.context.lineWidth=i),this.context.strokeStyle=Utils.rgbaToString(e,f,g,h),Utils.isEmpty(j)||(this.context.lineCap=j),this.context.stroke()},drawArc:function(a,b,c,d,e,f,g,h,i,j,k){Utils.isEmpty(k)&&(k="fill"),this.context.beginPath(),this._startDraw(k,f,g,h,i),Utils.isEmpty(j)||(this.context.lineWidth=j),this.context.arc(a,b,c,d,e,!1),this._endDraw(k)},drawCircle:function(a,b,c,d,e,f,g,h){Utils.isEmpty(h)&&(h="fill"),this.context.beginPath(),this._startDraw(h,d,e,f,g),this.context.arc(a,b,c,0,6.28,!1),this._endDraw(h)},drawSprite:function(a,b,c,d,e,f,g,h,i){Utils.isEmpty(a)||(this.context.save(),this.context.globalAlpha=Utils.clamp(0,i,1),this.context.translate(b+d/2,c+e/2),this.context.rotate(f),this.context.scale(g,h),this.context.drawImage(a,-d/2,-e/2),this.context.restore())},drawSpriteCropped:function(a,b,c,d,e,f,g,h,i,j,k,l,m){Utils.isEmpty(a)||(this.context.save(),this.context.globalAlpha=Utils.clamp(0,i,1),this.context.translate(b+d/2,c+e/2),this.context.rotate(f),this.context.scale(g,h),this.context.drawImage(a,j,k,l,m,-d/2,-e/2,d,e),this.context.restore())},drawPolygon:function(a,b,c,d,e,f,g,h){Utils.isEmpty(h)&&(h="fill"),this.context.beginPath(),this._startDraw(h,d,e,f,g),this.context.moveTo(b+a[0],c+a[1]);for(var i=2;i<a.length-1;i+=2)this.context.lineTo(b+a[i],c+a[i+1]);this.context.closePath(),this._endDraw(h)},drawRegularPolygon:function(a,b,c,d,e,f,g,h,i){Utils.isEmpty(i)&&(i="fill"),this.context.beginPath(),this._startDraw(i,e,f,g,h),this.context.moveTo(a+d*Math.cos(0),b+d*Math.sin(0));for(var j=1;c>=j;j+=1)this.context.lineTo(a+d*Math.cos(2*j*Math.PI/c),b+d*Math.sin(2*j*Math.PI/c));this.context.closePath(),this._endDraw(i)}});var Graphics=new Graphics,Sprite=Entity.extend({img:null,path:"",x:0,y:0,width:0,height:0,angle:0,scale:null,uv:null,rect:null,useBoundingBox:!0,radius:0,center:null,alpha:1,constructor:function(a){this.callParent(a),this.img=Graphics.getImage(a),this.path=a,Utils.isEmpty(this.img)?(this.width=0,this.height=0):(this.width=this.img.width,this.height=this.img.height),this.radius=Math.max(this.width,this.height)/2,this.scale={x:1,y:1},this.rect={x:this.x,y:this.y,w:this.width,h:this.height},this.uv={x:this.x,y:this.y,w:this.width,h:this.height},this.center={x:this.x+this.width/2,y:this.y+this.height/2}},draw:function(){this.callParent(),Graphics.drawSpriteCropped(this.img,this.x,this.y,this.width,this.height,this.angle,this.scale.x,this.scale.y,this.alpha,this.uv.x,this.uv.y,this.uv.w,this.uv.h)},drawDebug:function(){this.useBoundingBox?Graphics.drawRect(this.rect.x,this.rect.y,this.rect.w,this.rect.h,1,1,1,1,"stroke"):Graphics.drawCircle(this.x+this.width/2,this.y+this.height/2,this.radius,0,0,1,1,"stroke")},update:function(a){this.callParent(a),this.recalculate()},recalculate:function(){this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2,this.useBoundingBox&&(this.rect.x=this.x*this.scale.x,this.rect.y=this.y*this.scale.y,this.rect.w=this.width*this.scale.x,this.rect.h=this.height*this.scale.y)},setSource:function(a){this.path=a,this.img=Graphics.getImage(this.path),Utils.isEmpty(this.img)?(this.width=0,this.height=0):(this.width=this.img.width,this.height=this.img.height),this.radius=Math.max(this.width,this.height)/2,this.rect.w=this.width,this.rect.h=this.height,this.uv.w=this.width,this.uv.h=this.height,this.center.x=this.x+this.width/2,this.center.y=this.y+this.height/2},setUV:function(a,b,c,d){this.uv={x:a,y:b,w:c,h:d},this.width=c,this.height=d},resetUV:function(){this.uv={x:this.x,y:this.y,w:this.width,h:this.height}},collides:function(a){var b;return this.useBoundingBox&&a.useBoundingBox&&this.rect.x<=a.rect.x+a.rect.w&&a.rect.x<=this.rect.x+this.rect.w&&this.rect.y<=a.rect.y+a.rect.h&&a.rect.y<=this.rect.y+this.rect.h?!0:0!==this.radius&&0!==a.radius&&(b=Utils.distance(this.x+this.width/2,this.y+this.height/2,a.x+a.width/2,a.y+a.height/2),b<=this.radius+a.radius)?!0:!1},isPointInRect:function(a,b){return a>=this.rect.x&&a<=this.rect.x+this.rect.w&&b>=this.rect.y&&b<=this.rect.y+this.rect.h?!0:!1},isPointInCircle:function(a,b){return Utils.distance(this.x+this.width/2,this.y+this.height/2,a,b)<=this.radius?!0:!1}}),Atlas=Sprite.extend({constructor:function(a){this.callParent(a)},getImage:function(a,b,c,d){var e=new Sprite(this.path);return e.x=this.x,e.y=this.y,e.setUV(a,b,c,d),e},drawTile:function(a,b,c,d,e,f,g,h){Utils.isEmpty(this.img)||Graphics.context.drawImage(this.img,e,f,g,h,a,b,c,d)}}),Label=Sprite.extend({str:"",size:16,r:1,g:1,b:1,font:"Times",constructor:function(a){this.callParent("Label_"+a),this.str=a,this.x=0,this.y=0,this.alpha=1},draw:function(){Graphics.drawText(this.str,this.x,this.y,this.r,this.g,this.b,this.alpha,this.size,this.font)}}),Button=Sprite.extend({onClickFunc:null,text:null,enabled:!0,constructor:function(a,b,c,d){this.callParent(a,b,c),this.onClickFunc=d,Input.addInputReceiver(this)},setText:function(a){return this.text=new Text(a),this.text},draw:function(){this.callParent(),null!==this.text&&this.text.draw()},drawDebug:function(a,b,c){Graphics.drawRect(this.x,this.y,this.width,this.height,1,1,1)},onClickInput:function(a,b){var c=Graphics.getCanvasOffset();this.isPointInRect((a-c.left)/Graphics.scale.x,(b-c.top)/Graphics.scale.y)&&this.enabled&&this.onClickFunc(this)}}),ParticleBase=Sprite.extend({radius:10,wander:3.15,theta:Math.random(6.28),drag:.92,vx:0,vy:0,r:1,g:1,b:1,constructor:function(a,b,c,d){this.callParent(a,b,c,"particle"),this.radius=d,this.spawn()},update:function(a){this.callParent(a),this.vx*=this.drag,this.vy*=this.drag,this.theta+=Utils.randRange(-.5,.5)*this.wander,this.vx+=Math.sin(this.theta)*a,this.vy+=Math.cos(this.theta)*a,this.x+=this.vx,this.y+=this.vy,this.radius*=.96,this.inUse=this.radius>1},draw:function(){},spawn:function(){this.callParent(),this.radius=Utils.randRange(10,50),this.wander=Utils.randRange(.01,.05),this.drag=Utils.randRange(.5,.79),this.theta=6.28*Math.random(),this.force=Utils.randRange(.01,.03),this.vx=Math.sin(this.theta)*this.force,this.vy=Math.cos(this.theta)*this.force,this.r=Utils.randRange(0,1),this.g=Utils.randRange(0,1),this.b=Utils.randRange(0,1),this.alpha=Utils.randRange(0,1)},clone:function(){var a=new ParticleBase(this.path,this.x,this.y,this.radius);return a=Utils.copyAttributes(a,this)}}),ParticleCircle=ParticleBase.extend({constructor:function(a,b,c,d){this.callParent(a,b,c,d)},draw:function(){Graphics.drawCircle(this.x,this.y,this.radius,this.r,this.g,this.b,this.a)}}),ParticleSystem=Pool.extend({constructor:function(){this.callParent("ParticleSystem")},spawn:function(a,b,c){var d=[];d=this.callParent(c);for(var e=0;e<d.length;e++)d[e].x=a,d[e].y=b}}),AnimKey=TweenObject.extend({stopTime:0,constructor:function(a,b,c,d,e,f){this.callParent(a,d,e,b,f),this.timeStop=c}}),AnimKeyCall=Base.extend({object:null,time:0,func:Utils.emptyFunc,params:null,constructor:function(a,b,c,d){this.object=a,this.time=b,this.func=c,this.params=[],Utils.isEmpty(d)||(this.params=d)},exec:function(a){console.log(this.params),a[this.func].apply(a,this.params)}}),NEXT_FRAME_INCREMENT_TIME=.016,AnimClip=Base.extend({name:"",loop:!1,ease:!1,frames:null,lastFrameTime:0,currentTime:0,animator:null,constructor:function(a,b,c){this.name=a,Utils.isEmpty(b)||(this.loop=b),Utils.isEmpty(c)||(this.ease=c),this.frames=[]},_checkLastFrameTime:function(a){a>this.lastFrameTime&&(this.lastFrameTime=a)},addKey:function(a,b,c,d,e,f){var g=new AnimKey(a,b,c,d,e,f);this.frames.push(g),this._checkLastFrameTime(c)},addKeyCall:function(a,b,c,d){var e=new AnimKeyCall(a,b,c,d);this.frames.push(e),this._checkLastFrameTime(b)},removeKeys:function(a){},run:function(a){if(this.currentTime>this.lastFrameTime){if(!this.loop)return;this.reset()}this.currentTime+=a;for(var b=!1,c=0;c<this.frames.length;c++){var d,e=this.frames[c].time-this.currentTime;e>0&&NEXT_FRAME_INCREMENT_TIME>e&&(b=!0,this.frames[c]instanceof AnimKey?this.ease?(d=this.animator.getActor(this.frames[c].object),Utils.tween(d,this.frames[c].property,this.frames[c].destination,this.frames[c].time-this.frames[c].stopTime,this.frames[c].easing)):this.animator.onActorUpdate(this.frames[c].object,this.frames[c].property,this.frames[c].destination):this.frames[c]instanceof AnimKeyCall&&(d=this.animator.getActor(this.frames[c].object),this.frames[c].exec(d)))}b&&(this.currentTime+=NEXT_FRAME_INCREMENT_TIME)},reset:function(){this.currentTime=0},destroy:function(){this.frames=[]}}),Animator=Entity.extend({playing:!1,paused:!1,clips:null,currentAnim:"",constructor:function(){this.callParent(),this.clips={}},addClip:function(a,b){a.animator=this,this.clips[a.name]={clip:a,actors:b}},remove:function(a){Utils.isEmpty(this.animations[a.name])||delete this.clips[a.name]},removeAll:function(){this.stop(),this.clips={}},getActor:function(a){if(this.playing||this.paused){var b=this.clips[this.currentAnim].actors;for(var c in b)if(c===a)return b[c]}return null},onActorUpdate:function(a,b,c){var d=this.getActor(a);Utils.isEmpty(d)||(d[b]=c)},play:function(a){this.playing=!0,this.paused=!1,this.currentAnim=a,this.clips[this.currentAnim].clip.reset()},pause:function(){this.paused=!this.paused},stop:function(){this.playing=!1,this.paused=!1,this.currentAnim=""},update:function(a){this.playing&&!this.paused&&this.clips[this.currentAnim].clip.run(a)},destroy:function(){}}),Body=Entity.extend({group:"",type:"AABB",x:0,y:0,w:1,h:1,extents:null,radius:1,mass:1,elasticity:.235,friction:.9,velocity:null,isDynamic:!0,isSolid:!0,skippedGroups:null,groupsOnCallbacks:null,constructor:function(a){this.callParent(),this.group=a||"default",this.extents={x:.5,y:.5},this.velocity={x:0,y:0},this.skippedGroups=[],this.groupsOnCallbacks={},Physics.addBody(this)},destroy:function(){Physics.removeBody(this)},makeCircle:function(a,b,c){this.type=Physics.V_SPHERE,this.setPosition(a,b),this.setRadius(c)},makeRect:function(a,b,c,d){this.type=Physics.V_AABB,this.setPosition(a,b),this.setSize(c,d)},setPosition:function(a,b){this.x=a,this.y=b},setSize:function(a,b){this.extents.x=a/2,this.extents.y=b/2,this.w=a,this.h=b},setRadius:function(a){this.extents.x=a,this.extents.y=a,this.w=2*a,this.h=2*a,this.radius=a},skipGroup:function(a){this.skippedGroups.push(a)},skipSelfGroup:function(a){a?this.skipGroup(this.group):this.unskipGroup(this.group)},unskipGroup:function(a){var b=this.skippedGroups.indexOf(a);b>=0&&this.bodies.splice(b,1)},canSkip:function(a){return-1!==this.skippedGroups.indexOf(a)?!0:!1},onCollision:function(a,b){this.groupsOnCallbacks[a]=b},intersects:function(a){return this.type===Physics.V_SPHERE&&a.type===Physics.V_SPHERE?Physics.testSPHEREvsSPHERE(this,a):this.type===Physics.V_AABB&&a.type===Physics.V_AABB?Physics.testAABBvsAABB(this,a):Physics.testAABBvsSPHERE(this,a)},processCollision:function(a,b){var c,d,e={x:b.otherObj.x-b.thisObj.x,y:b.otherObj.y-b.thisObj.y},f=this.calculateMassRatio(a,!0);if(f.result){c=f.thisObj,d=f.otherObj,this.x+=e.x*c,this.y+=e.y*c,a.x-=e.x*d,a.y-=e.y*d;

var g={x:this.velocity.x-a.velocity.x,y:this.velocity.y-a.velocity.y},h=e.x*g.x+e.y*g.y;if(!(h>0)){var i=e.x*e.x+e.y*e.y;if(!(1e-4>i)){f=this.calculateMassRatio(a,!1),c=f.thisObj,d=f.otherObj;var j=(this.elasticity,this.friction,{x:e.x*(h/i),y:e.y*(h/i)}),k={x:g.x-j.x,y:g.y-j.y};this.velocity.x-=(1+this.elasticity)*c*j.x+k.x+this.friction,this.velocity.y-=(1+this.elasticity)*c*j.y+k.y+this.friction}}}},execCallback:function(a){a.group in this.groupsOnCallbacks&&this.groupsOnCallbacks[a.group](a)},isPointInside:function(a,b){switch(this.type){case Physics.V_SPHERE:if(Math.sqrt((this.x-a)*(this.x-a)+(this.y-b)*(this.y-b))>this.radius)return!0;break;case Physics.V_AABB:default:var c=this.x-this.extents.x,d=this.y-this.extents.y,e=this.x+this.extents.x,f=this.y+this.extents.y;if(a>=c&&e>=a&&b>=d&&f>=b)return!0}},calculateMassRatio:function(a,b){var c={result:!1,thisObj:0,otherObj:0},d=0,e=0,f=this.mass+a.mass;return 1e-6>f?c:(a.mass<1e-7||a.isDynamic===!1?(d=1,e=0):this.mass<1e-7||this.isDynamic===!1?(d=0,e=1):b?(d=.5,e=1-d):(d=a.mass/f,e=1-d),c.result=!0,c.thisObj=d,c.otherObj=e,c)},addImpulse:function(a,b){this.velocity.x+=a/this.mass,this.velocity.y+=b/this.mass},resetVelocity:function(){this.velocity.x=0,this.velocity.y=0},update:function(a){this.callParent(a),this.isDynamic&&this.isSolid&&(this.velocity.x+=Physics.gravity.x,this.velocity.y+=-1*Physics.gravity.y,this.x+=this.velocity.x*a,this.y+=this.velocity.y*a,this.velocity.x*=this.friction,this.velocity.y*=this.friction)},drawDebug:function(a,b,c,d){this.type===Physics.V_AABB?Graphics.drawRect(this.x-this.w/2,this.y-this.h/2,this.w,this.h,a,b,c,d):this.type===Physics.V_SPHERE&&Graphics.drawCircle(this.x,this.y,this.radius,a,b,c,d)}}),PhysicsDef=Entity.extend({gravity:null,bodies:null,V_AABB:"AABB",V_SPHERE:"SPHERE",constructor:function(){this.callParent(),this.gravity={x:0,y:-10},this.bodies=[]},addBody:function(a){this.add(a),this.bodies.push(a)},newBody:function(a){var b=new Body(a);return b},removeBody:function(a){var b=this.bodies.indexOf(a);b>=0&&(this.bodies.splice(b,1),this.remove(a))},setGravity:function(a,b){this.gravity.x=a,this.gravity.y=b},axisIntersect:function(a,b,c,d,e){var f=d-a,g=b-c;return 0>f||0>g?[!1]:(e=g>f?f:-g,[!0,e])},testAABBvsAABB:function(a,b){var c={result:!1,thisObj:{},otherObj:{}},d={x:a.x-a.extents.x,y:a.y-a.extents.y},e={x:a.x+a.extents.x,y:a.y+a.extents.y},f={x:b.x-b.extents.x,y:b.y-b.extents.y},g={x:b.x+b.extents.x,y:b.y+b.extents.y},h={x:0,y:0},i=this.axisIntersect(d.x,e.x,f.x,g.x,h.x),j=this.axisIntersect(d.y,e.y,f.y,g.y,h.y);if(!i[0]||!j[0])return c;h.x=i[1],h.y=j[1];var k=Math.abs(h.x);return Math.abs(h.y)<k?(k=Math.abs(h.y),h.x=0):h.y=0,c.result=!0,c.thisObj={x:0,y:0},c.otherObj=h,c},testSPHEREvsSPHERE:function(a,b){var c={result:!1,thisObj:{},otherObj:{}},d={x:b.x-a.x,y:b.y-a.y},e=d.x*d.x+d.y*d.y,f=a.radius+b.radius,g=f*f;return e>g?c:(d.x/=Math.sqrt(e),d.y/=Math.sqrt(e),c.thisObj={x:a.x+d.x*a.radius,y:a.y+d.y*a.radius},c.otherObj={x:b.x-d.x*b.radius,y:b.y-d.y*b.radius},c.result=!0,c)},testAABBvsSPHERE:function(a,b){return this.testAABBvsAABB(a,b)},update:function(a){this.callParent(a);for(var b=0;b<this.bodies.length;b++)for(var c=0;c<this.bodies.length;c++)if(b!==c){var d=this.bodies[b],e=this.bodies[c];if(!d.canSkip(e.group)){var f=d.intersects(e);f.result===!0&&(d.isSolid&&e.isSolid&&d.processCollision(e,f),d.execCallback(e))}}}}),Physics=new PhysicsDef,SoundDef=Base.extend({soundSupported:!1,constructor:function(){this.soundSupported=!!document.createElement("audio").canPlayType},hasSound:function(){return this.soundSupported}}),Sound=new SoundDef,Song=Base.extend({path:"",loops:!1,song:null,playing:!1,constructor:function(a,b){this.path=a,this.loops=b,this.song=document.createElement("audio"),this.song.setAttribute("src",this.path),this.loops&&this.song.setAttribute("loop",!0)},play:function(){Audio.hasSound()&&null!==this.song&&(this.playing=!0,this.song.play())},pause:function(){Audio.hasSound()&&null!==this.song&&(this.playing=!1,this.song.pause())},stop:function(){Audio.hasSound()&&null!==this.song&&(this.playing=!1,this.song.pause(),isNaN(this.song.duration)||(this.song.currentTime=0))},setVolume:function(a){Audio.hasSound()&&null!==this.song&&(this.song.volume=a)}});
//# sourceMappingURL=micron.min.js.map